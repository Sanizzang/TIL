### Transaction, 트랜잭션

트랜잭션(Transaction)이란, 데이터베이스의 상태를 변경시키기 위해 수행하는 작업 단위이다.
(여러 쿼리를 논리적으로 하나의 작업으로 묶어주는 것)

트랜잭션은 상황에 따라 여러 개가 만들어질 수 있다.
하나의 트랜잭션은 Commit(저장)되거나 Rollback(철회)될 수 있다.

#### 트랜잭션의 특징

1. 트랜잭션은 데이터베이스 시스템에서 병행 제어 및 회복 작업 시 처리되는 작업의 논리적 단위이다.
2. 사용자가 시스템에 대한 서비스 요구 시 시스템이 응답하기 위한 상태 변환 과정의 작업단위이다.
3. 하나의 트랜잭션은 Commit되거나 Rollback 된다.

### 트랜잭션의 성질

- 트랜잭션이 안전하게 수행된다는 것을 보장하기 위한 성질

#### Atomicity (원자성)

1. 트랜잭션의 연산은 데이터베이스에 모두 반영되든지 아니면 전혀 반영되지 않아야 한다.
2. 트랜잭션 내의 모든 명령은 반드시 수행되어야 하며, 모두가 완벽히 수행되지 않고 어느하나라도 오류가 발생하면 트랜잭션 전부가 취소되어야 한다.

#### Consistency (일관성)

1. 트랜잭션이 그 실행을 성공적으로 완료하면 언제나 일관성 있는 데이터베이스 상태로 변환한다.
2. 시스템이 가지고 있는 고정요소는 트랜잭션 수행 전과 트랜잭션 수행 완료 후의 상태가 같아야 한다.

#### Isolation (독립성, 격리성)

1. 둘 이상의 트랜잭션이 동시에 병행 실행되는 경우 어느 하나의 트랜잭션 실행중에 다른 트랜잭션의 연산이 끼어들 수 없다.
2. 수행중인 트랜잭션은 완전히 완료될 때까지 다른 트랜잭션에서 수행 결과를 참조할 수 없다.

#### Drability (영속성, 지속성)

1. 성공적으로 완료된 트랜잭션의 결과는 시스템이 고장나더라도 영구적으로 반영되어야 한다.

### 트랜잭션 연산 및 상태

#### Commit연산

1. Commit 연산은 한 개의 논리적 단위(트랜잭션)에 대한 작업이 성공적으로 끝났고 데이터베이스가 다시 일관된 상태에 있을 때, 이 트랜잭션이 행한 갱신 연산이 완료된 것을 트랜잭션 관리자에게 알려주는 연산이다.

#### Rollback연산

1. Rollback 연산은 하나의 트랜잭션 처리가 비정상적으로 종료되어 데이터베이스의 일관성을 깨뜨렸을 때, 이 트랜잭션의 일부가 정상적으로 처리되었더라도 트랜잭션의 원자성을 구현하기 위해 이 트랜잭션이 행한 모든 연산을 취소(Undo)하는 연산이다.
2. Rollback시에는 해당 트랜잭션을 재시작하거나 폐기한다.

### 트랜잭션의 상태

- 활동(Active): 트랜잭션이 실행중인 상태
- 실패(Failed): 트랜잭션 실행에 오류가 발생하여 중단된 상태
- 철회(Aborted): 트랜잭션이 비정상적으로 종료되어 Rollback 연산을 수행한 상태
- 부분 완료(Partially Committed): 트랜잭션의 마지막 연산까지 실행했지만, Commit 연산이 실행되기 직전의 상태
- 완료(Committed): 트랜잭션이 성공적으로 종료되어 Commit 연산을 실행한 후의 상태

### 트랜잭션 격리 수준

- 동시에 DB에 접근할 때 그 접근을 어떻게 제어할지에 대한 설정
  ![](https://velog.velcdn.com/images/sanizzang00/post/2c15a635-6cb0-4948-bebb-c97b4cbdb7f0/image.png)

#### READ-UNCOMMITTED

: 커밋 전의 트랜잭션의 데이터 변경 내용을 다른 트랜잭션이 읽는 것 허용

![](https://velog.velcdn.com/images/sanizzang00/post/193805f8-16d4-4360-8f30-a20f7fb50b33/image.png)

- Dirty Read 현상이 발생할 수 있다.
  트랜잭션 A가 만약 트랜잭션을 끝마치지 못하고 롤백 한다면 트랜잭션 B는 무효가 된 데이터 값을 일고 처리를 하기 때문에 문제가 생긴다.
- 뿐만 아니라 Non Repeatable Read, Phantom Read 문제도 나타난다.

#### READ-COMMITTED

: 커밋이 완료된 트랜잭션의 변경사항만 다른 트랜잭션에서 조회 가능
![](https://velog.velcdn.com/images/sanizzang00/post/e2b198eb-9e52-4246-a434-f52ccc5e627e/image.png)

- Non-Repeatable Read, Phatom Read 현상 발생

Non-Repeatable?
같은 트랜잭션 내에서 SELECT문을 두 번 조회를 했는데, 두 값이 다른 값이 나오는 데이터 불일치 문제이다.

#### REPEATABLE-READ

: 트랜잭션 범위 내에서 조회한 내용이 항상 동일함을 보장
READ-COMMITED와 다른 점은 한 트랜잭션이 조회한 데이터는 트랜잭션이 종료될 때까지 트랜잭션이 변경하거나 삭제하는 것을 막으므로
한번 조회한 데이터는 반복적으로 조회해도 같은 값을 반환한다.

![](https://velog.velcdn.com/images/sanizzang00/post/76fd71f8-8da9-4aea-9415-6690e6e33f62/image.png)

- Phantom Read 발생

Phantom Read?
Non-Repeatable Read의 한 종류로 조건이 걸렸든 안 걸렸든 select 문을 쓸 때 나타날 수 있는 현상
해당 쿼리로 읽히는 데이터에 들어가는 행위 새로 생기거나 없어져 있는 현상

#### SERIALIZABLE

: 한 트랜잭션에서 사용하는 데이터를 다른 트랜잭션에서 접근 불가

![](https://velog.velcdn.com/images/sanizzang00/post/cdf71005-105e-4ca4-bb11-bc8491af5b3e/image.png)
